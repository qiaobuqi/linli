<view class="container">
  <block wx:if="{{task}}">
    <!-- ä»»åŠ¡çŠ¶æ€æ¨ªå¹… -->
    <view class="status-banner status-{{task.status}}">
      <text class="status-icon">{{statusConfig[task.status].icon}}</text>
      <text class="status-text">{{statusConfig[task.status].text}}</text>
    </view>

    <!-- ä»»åŠ¡ä¸»ä½“ä¿¡æ¯ -->
    <view class="task-header">
      <view class="task-type-badge badge-{{task.type}}">
        <text class="badge-emoji">{{task.typeEmoji}}</text>
        <text class="badge-text">{{task.typeName}}</text>
      </view>
      
      <view class="task-title-section">
        <text class="task-title">{{task.title}}</text>
        <view class="urgent-tag" wx:if="{{task.urgency}}">
          <text class="urgent-icon">ğŸ”¥</text>
          <text class="urgent-text">åŠ æ€¥</text>
        </view>
      </view>

      <view class="task-price-box">
        <text class="price-label">æŠ¥é…¬</text>
        <view class="price-value">
          <text class="price-symbol">Â¥</text>
          <text class="price-amount">{{task.price}}</text>
        </view>
      </view>
    </view>

    <!-- ä»»åŠ¡è¯¦æƒ… -->
    <view class="task-detail">
      <view class="detail-section">
        <view class="section-title">
          <text class="title-icon">ğŸ“</text>
          <text class="title-text">è¯¦ç»†æè¿°</text>
        </view>
        <text class="detail-desc">{{task.description}}</text>
      </view>

      <!-- ä»»åŠ¡å›¾ç‰‡ -->
      <view class="detail-section" wx:if="{{task.images && task.images.length > 0}}">
        <view class="section-title">
          <text class="title-icon">ğŸ“·</text>
          <text class="title-text">ç›¸å…³å›¾ç‰‡</text>
        </view>
        <view class="images-grid">
          <image 
            class="task-image" 
            wx:for="{{task.images}}" 
            wx:key="index"
            src="{{item}}" 
            mode="aspectFill"
            bindtap="previewImage"
            data-url="{{item}}"
          ></image>
        </view>
      </view>

      <!-- ä»»åŠ¡ä¿¡æ¯ -->
      <view class="detail-section">
        <view class="section-title">
          <text class="title-icon">â„¹ï¸</text>
          <text class="title-text">ä»»åŠ¡ä¿¡æ¯</text>
        </view>
        <view class="info-list">
          <view class="info-item">
            <text class="info-label">ğŸ“ ä½ç½®è·ç¦»</text>
            <text class="info-value">{{task.distance || '500m'}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">â° å‘å¸ƒæ—¶é—´</text>
            <text class="info-value">{{task.created_at}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">ğŸ‘ æµè§ˆæ¬¡æ•°</text>
            <text class="info-value">{{task.viewCount || 0}}æ¬¡</text>
          </view>
          <view class="info-item">
            <text class="info-label">ğŸ’¬ æ¥å•äººæ•°</text>
            <text class="info-value">{{task.applicantCount || 0}}äºº</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å‘å¸ƒè€…ä¿¡æ¯å¡ç‰‡ -->
    <view class="creator-card">
      <view class="creator-header">
        <view class="section-title">
          <text class="title-icon">ğŸ‘¤</text>
          <text class="title-text">å‘å¸ƒè€…ä¿¡æ¯</text>
        </view>
        <text class="verify-badge" wx:if="{{task.creator.verified}}">âœ“ å·²è®¤è¯</text>
      </view>

      <view class="creator-profile">
        <image class="creator-avatar" src="{{task.creator.avatar_url}}" mode="aspectFill"></image>
        <view class="creator-info">
          <view class="creator-name-row">
            <text class="creator-name">{{task.creator.nickname}}</text>
            <view class="creator-level">
              <text class="level-icon">â­</text>
              <text class="level-text">Lv.{{task.creator.level || 1}}</text>
            </view>
          </view>
          <view class="creator-stats">
            <text class="stat-item">ä¿¡ç”¨åˆ† {{task.creator.creditScore || 100}}</text>
            <text class="stat-separator">Â·</text>
            <text class="stat-item">å‘å¸ƒ {{task.creator.publishCount || 0}}æ¬¡</text>
            <text class="stat-separator">Â·</text>
            <text class="stat-item">å®Œæˆ {{task.creator.completeCount || 0}}æ¬¡</text>
          </view>
        </view>
      </view>

      <!-- å‘å¸ƒè€…æ ‡ç­¾ -->
      <view class="creator-tags" wx:if="{{task.creator.tags && task.creator.tags.length > 0}}">
        <view class="creator-tag" wx:for="{{task.creator.tags}}" wx:key="index">
          {{item}}
        </view>
      </view>

      <!-- è”ç³»æŒ‰é’® -->
      <view class="creator-actions">
        <button class="btn-contact" open-type="contact">
          <text class="btn-icon">ğŸ’¬</text>
          <text class="btn-text">è”ç³»TA</text>
        </button>
        <button class="btn-profile" bindtap="viewProfile">
          <text class="btn-icon">ğŸ‘¤</text>
          <text class="btn-text">æŸ¥çœ‹ä¸»é¡µ</text>
        </button>
      </view>
    </view>

    <!-- è¯„ä»·åŒºåŸŸï¼ˆå¦‚æœä»»åŠ¡å·²å®Œæˆï¼‰ -->
    <view class="reviews-section" wx:if="{{task.status === 'completed' && task.reviews && task.reviews.length > 0}}">
      <view class="section-title">
        <text class="title-icon">â­</text>
        <text class="title-text">æœåŠ¡è¯„ä»·</text>
      </view>
      <view class="review-list">
        <view class="review-item" wx:for="{{task.reviews}}" wx:key="id">
          <view class="review-header">
            <image class="reviewer-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
            <view class="reviewer-info">
              <text class="reviewer-name">{{item.name}}</text>
              <view class="review-rating">
                <text class="star" wx:for="{{[1,2,3,4,5]}}" wx:key="index" wx:for-item="star">
                  {{star <= item.rating ? 'â­' : 'â˜†'}}
                </text>
              </view>
            </view>
            <text class="review-time">{{item.time}}</text>
          </view>
          <text class="review-content">{{item.content}}</text>
        </view>
      </view>
    </view>

    <!-- ç±»ä¼¼éœ€æ±‚æ¨è -->
    <view class="similar-section" wx:if="{{similarTasks && similarTasks.length > 0}}">
      <view class="section-title">
        <text class="title-icon">ğŸ”¥</text>
        <text class="title-text">ç±»ä¼¼éœ€æ±‚</text>
      </view>
      <scroll-view class="similar-scroll" scroll-x>
        <view class="similar-item" wx:for="{{similarTasks}}" wx:key="id" bindtap="viewTask" data-id="{{item.id}}">
          <view class="similar-type">{{item.typeName}}</view>
          <text class="similar-title">{{item.title}}</text>
          <text class="similar-price">Â¥{{item.price}}</text>
        </view>
      </scroll-view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-bar">
      <view class="bar-left">
        <button class="btn-icon-action" bindtap="toggleCollect">
          <text class="action-icon">{{collected ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="action-text">æ”¶è—</text>
        </button>
        <button class="btn-icon-action" open-type="share">
          <text class="action-icon">ğŸ“¤</text>
          <text class="action-text">åˆ†äº«</text>
        </button>
      </view>
      
      <view class="bar-right">
        <button 
          class="btn-primary-action" 
          bindtap="claimTask" 
          wx:if="{{task.status === 'pending'}}">
          <text class="btn-icon">âœ…</text>
          <text class="btn-text">æˆ‘æ¥å¸®å¿™</text>
        </button>
        <button 
          class="btn-disabled" 
          disabled
          wx:elif="{{task.status === 'claimed'}}">
          å·²è¢«æ¥å•
        </button>
        <button 
          class="btn-completed" 
          disabled
          wx:elif="{{task.status === 'completed'}}">
          å·²å®Œæˆ
        </button>
      </view>
    </view>

  </block>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:else>
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
